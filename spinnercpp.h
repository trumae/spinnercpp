#ifndef __SPINNERCPP__
#define __SPINNERCPP__

#include <string>
#include <chrono>
#include <thread>
#include <mutex>
#include <vector>
#include <iostream>

namespace spinnercpp {
  using namespace std;

  vector<vector<string>> CharSets = {
    {"‚Üê", "‚Üñ", "‚Üë", "‚Üó", "‚Üí", "‚Üò", "‚Üì", "‚Üô"},
    {"‚ñÅ", "‚ñÉ", "‚ñÑ", "‚ñÖ", "‚ñÜ", "‚ñá", "‚ñà", "‚ñá", "‚ñÜ", "‚ñÖ", "‚ñÑ", "‚ñÉ", "‚ñÅ"},
    {"‚ññ", "‚ñò", "‚ñù", "‚ñó"},
    {"‚î§", "‚îò", "‚î¥", "‚îî", "‚îú", "‚îå", "‚î¨", "‚îê"},
    {"‚ó¢", "‚ó£", "‚ó§", "‚ó•"},
    {"‚ó∞", "‚ó≥", "‚ó≤", "‚ó±"},
    {"‚ó¥", "‚ó∑", "‚ó∂", "‚óµ"},
    {"‚óê", "‚óì", "‚óë", "‚óí"},
    {".", "o", "O", "@", "*"},
    {"|", "/", "-", "\\"},
    {"‚ó°‚ó°", "‚äô‚äô", "‚ó†‚ó†"},
    {"‚£æ", "‚£Ω", "‚£ª", "‚¢ø", "‚°ø", "‚£ü", "‚£Ø", "‚£∑"},
    {">))'>", " >))'>", "  >))'>", "   >))'>", "    >))'>", "   <'((<", "  <'((<", " <'((<"},
    {"‚†Å", "‚†Ç", "‚†Ñ", "‚°Ä", "‚¢Ä", "‚††", "‚†ê", "‚†à"},
    {"‚†ã", "‚†ô", "‚†π", "‚†∏", "‚†º", "‚†¥", "‚†¶", "‚†ß", "‚†á", "‚†è"},
    {"a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z"},
    {"‚ñâ", "‚ñä", "‚ñã", "‚ñå", "‚ñç", "‚ñé", "‚ñè", "‚ñé", "‚ñç", "‚ñå", "‚ñã", "‚ñä", "‚ñâ"},
    {"‚ñ†", "‚ñ°", "‚ñ™", "‚ñ´"},
    {"‚Üê", "‚Üë", "‚Üí", "‚Üì"},
    {"‚ï´", "‚ï™"},
    {"‚áê", "‚áñ", "‚áë", "‚áó", "‚áí", "‚áò", "‚áì", "‚áô"},
    {"‚†Å", "‚†Å", "‚†â", "‚†ô", "‚†ö", "‚†í", "‚†Ç", "‚†Ç", "‚†í", "‚†≤", "‚†¥", "‚†§", "‚†Ñ", "‚†Ñ", "‚†§", "‚††", "‚††", "‚†§", "‚†¶", "‚†ñ", "‚†í", "‚†ê", "‚†ê", "‚†í", "‚†ì", "‚†ã", "‚†â", "‚†à", "‚†à"},
    {"‚†à", "‚†â", "‚†ã", "‚†ì", "‚†í", "‚†ê", "‚†ê", "‚†í", "‚†ñ", "‚†¶", "‚†§", "‚††", "‚††", "‚†§", "‚†¶", "‚†ñ", "‚†í", "‚†ê", "‚†ê", "‚†í", "‚†ì", "‚†ã", "‚†â", "‚†à"},
    {"‚†Å", "‚†â", "‚†ô", "‚†ö", "‚†í", "‚†Ç", "‚†Ç", "‚†í", "‚†≤", "‚†¥", "‚†§", "‚†Ñ", "‚†Ñ", "‚†§", "‚†¥", "‚†≤", "‚†í", "‚†Ç", "‚†Ç", "‚†í", "‚†ö", "‚†ô", "‚†â", "‚†Å"},
    {"‚†ã", "‚†ô", "‚†ö", "‚†í", "‚†Ç", "‚†Ç", "‚†í", "‚†≤", "‚†¥", "‚†¶", "‚†ñ", "‚†í", "‚†ê", "‚†ê", "‚†í", "‚†ì", "‚†ã"},
    {"ÔΩ¶", "ÔΩß", "ÔΩ®", "ÔΩ©", "ÔΩ™", "ÔΩ´", "ÔΩ¨", "ÔΩ≠", "ÔΩÆ", "ÔΩØ", "ÔΩ±", "ÔΩ≤", "ÔΩ≥", "ÔΩ¥", "ÔΩµ", "ÔΩ∂", "ÔΩ∑", "ÔΩ∏", "ÔΩπ", "ÔΩ∫", "ÔΩª", "ÔΩº", "ÔΩΩ", "ÔΩæ", "ÔΩø", "ÔæÄ", "ÔæÅ", "ÔæÇ", "ÔæÉ", "ÔæÑ", "ÔæÖ", "ÔæÜ", "Ôæá", "Ôæà", "Ôæâ", "Ôæä", "Ôæã", "Ôæå", "Ôæç", "Ôæé", "Ôæè", "Ôæê", "Ôæë", "Ôæí", "Ôæì", "Ôæî", "Ôæï", "Ôæñ", "Ôæó", "Ôæò", "Ôæô", "Ôæö", "Ôæõ", "Ôæú", "Ôæù"},
    {".", "..", "..."},
    {"‚ñÅ", "‚ñÇ", "‚ñÉ", "‚ñÑ", "‚ñÖ", "‚ñÜ", "‚ñá", "‚ñà", "‚ñâ", "‚ñä", "‚ñã", "‚ñå", "‚ñç", "‚ñé", "‚ñè", "‚ñè", "‚ñé", "‚ñç", "‚ñå", "‚ñã", "‚ñä", "‚ñâ", "‚ñà", "‚ñá", "‚ñÜ", "‚ñÖ", "‚ñÑ", "‚ñÉ", "‚ñÇ", "‚ñÅ"},
    {".", "o", "O", "¬∞", "O", "o", "."},
    {"+", "x"},
    {"v", "<", "^", ">"},
    {">>--->", " >>--->", "  >>--->", "   >>--->", "    >>--->", "    <---<<", "   <---<<", "  <---<<", " <---<<", "<---<<"},
    {"|", "||", "|||", "||||", "|||||", "|||||||", "||||||||", "|||||||", "||||||", "|||||", "||||", "|||", "||", "|"},
    {"[          ]", "[=         ]", "[==        ]", "[===       ]", "[====      ]", "[=====     ]", "[======    ]", "[=======   ]", "[========  ]", "[========= ]", "[==========]"},
    {"(*---------)", "(-*--------)", "(--*-------)", "(---*------)", "(----*-----)", "(-----*----)", "(------*---)", "(-------*--)", "(--------*-)", "(---------*)"},
    {"‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí", "‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí", "‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñí‚ñí", "‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí", "‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà"},
    {"[                    ]", "[=>                  ]", "[===>                ]", "[=====>              ]", "[======>             ]", "[========>           ]", "[==========>         ]", "[============>       ]", "[==============>     ]", "[================>   ]", "[==================> ]", "[===================>]"},
    {"üåç", "üåé", "üåè"},
    {"‚óú", "‚óù", "‚óû", "‚óü"},
    {"‚¨í", "‚¨î", "‚¨ì", "‚¨ï"},
    {"‚¨ñ", "‚¨ò", "‚¨ó", "‚¨ô"},
    {"[>>>          >]", "[]>>>>        []", "[]  >>>>      []", "[]    >>>>    []", "[]      >>>>  []", "[]        >>>>[]", "[>>          >>]"},
    {"‚ô†", "‚ô£", "‚ô•", "‚ô¶"},
    {"‚ûû", "‚ûü", "‚û†", "‚û°", "‚û†", "‚ûü"},
    {"  . . . .", ".   . . .", ". .   . .", ". . .   .", ". . . .  ", ". . . . ."},
    {"‚é∫", "‚éª", "‚éº", "‚éΩ", "‚éº", "‚éª"},
    {"‚ñπ‚ñπ‚ñπ‚ñπ‚ñπ", "‚ñ∏‚ñπ‚ñπ‚ñπ‚ñπ", "‚ñπ‚ñ∏‚ñπ‚ñπ‚ñπ", "‚ñπ‚ñπ‚ñ∏‚ñπ‚ñπ", "‚ñπ‚ñπ‚ñπ‚ñ∏‚ñπ", "‚ñπ‚ñπ‚ñπ‚ñπ‚ñ∏"},
    {"[    ]", "[   =]", "[  ==]", "[ ===]", "[====]", "[=== ]", "[==  ]", "[=   ]"},
    {"( ‚óè    )", "(  ‚óè   )", "(   ‚óè  )", "(    ‚óè )", "(     ‚óè)", "(    ‚óè )", "(   ‚óè  )", "(  ‚óè   )", "( ‚óè    )"},
    {"‚ú∂", "‚ú∏", "‚úπ", "‚ú∫", "‚úπ", "‚ú∑"},
    {"‚ñê|\\____________‚ñå", "‚ñê_|\\___________‚ñå", "‚ñê__|\\__________‚ñå", "‚ñê___|\\_________‚ñå", "‚ñê____|\\________‚ñå", "‚ñê_____|\\_______‚ñå", "‚ñê______|\\______‚ñå", "‚ñê_______|\\_____‚ñå", "‚ñê________|\\____‚ñå", "‚ñê_________|\\___‚ñå", "‚ñê__________|\\__‚ñå", "‚ñê___________|\\_‚ñå", "‚ñê____________|\\‚ñå", "‚ñê____________/|‚ñå", "‚ñê___________/|_‚ñå", "‚ñê__________/|__‚ñå", "‚ñê_________/|___‚ñå", "‚ñê________/|____‚ñå", "‚ñê_______/|_____‚ñå", "‚ñê______/|______‚ñå", "‚ñê_____/|_______‚ñå", "‚ñê____/|________‚ñå", "‚ñê___/|_________‚ñå", "‚ñê__/|__________‚ñå", "‚ñê_/|___________‚ñå", "‚ñê/|____________‚ñå"},
    {"‚ñê‚†Ç       ‚ñå", "‚ñê‚†à       ‚ñå", "‚ñê ‚†Ç      ‚ñå", "‚ñê ‚††      ‚ñå", "‚ñê  ‚°Ä     ‚ñå", "‚ñê  ‚††     ‚ñå", "‚ñê   ‚†Ç    ‚ñå", "‚ñê   ‚†à    ‚ñå", "‚ñê    ‚†Ç   ‚ñå", "‚ñê    ‚††   ‚ñå", "‚ñê     ‚°Ä  ‚ñå", "‚ñê     ‚††  ‚ñå", "‚ñê      ‚†Ç ‚ñå", "‚ñê      ‚†à ‚ñå", "‚ñê       ‚†Ç‚ñå", "‚ñê       ‚††‚ñå", "‚ñê       ‚°Ä‚ñå", "‚ñê      ‚†† ‚ñå", "‚ñê      ‚†Ç ‚ñå", "‚ñê     ‚†à  ‚ñå", "‚ñê     ‚†Ç  ‚ñå", "‚ñê    ‚††   ‚ñå", "‚ñê    ‚°Ä   ‚ñå", "‚ñê   ‚††    ‚ñå", "‚ñê   ‚†Ç    ‚ñå", "‚ñê  ‚†à     ‚ñå", "‚ñê  ‚†Ç     ‚ñå", "‚ñê ‚††      ‚ñå", "‚ñê ‚°Ä      ‚ñå", "‚ñê‚††       ‚ñå"},
    {"¬ø", "?"},
    {"‚¢π", "‚¢∫", "‚¢º", "‚£∏", "‚£á", "‚°ß", "‚°ó", "‚°è"},
    {"‚¢Ñ", "‚¢Ç", "‚¢Å", "‚°Å", "‚°à", "‚°ê", "‚°†"},
    {".  ", ".. ", "...", " ..", "  .", "   "},
    {".", "o", "O", "¬∞", "O", "o", "."},
    {"‚ñì", "‚ñí", "‚ñë"},
    {"‚ñå", "‚ñÄ", "‚ñê", "‚ñÑ"},
    {"‚ä∂", "‚ä∑"},
    {"‚ñ™", "‚ñ´"},
    {"‚ñ°", "‚ñ†"},
    {"‚ñÆ", "‚ñØ"},
    {"-", "=", "‚â°"},
    {"d", "q", "p", "b"},
    {"‚àô‚àô‚àô", "‚óè‚àô‚àô", "‚àô‚óè‚àô", "‚àô‚àô‚óè", "‚àô‚àô‚àô"},
    {"üåë ", "üåí ", "üåì ", "üåî ", "üåï ", "üåñ ", "üåó ", "üåò "},
    {"‚òó", "‚òñ"},
    {"‚ßá", "‚ßÜ"},
    {"‚óâ", "‚óé"},
    {"„äÇ", "„äÄ", "„äÅ"},
    {"‚¶æ", "‚¶ø"},
    {"·Äù", "·ÅÄ"},
    {"‚ñå", "‚ñÄ", "‚ñê‚ñÑ"},
  };

  class spinner {
  public:
  spinner(chrono::duration<int,std::milli> delay=200ms,
	  int charset = 0,
	  string finalmsg = "",
	  string prefix = "",
	  string suffix = ""
	  ) : delay_(delay),
      chars_(charset),
      finalmsg_(finalmsg),
      prefix_(prefix),
      suffix_(suffix),
      active_(false) {				
    }

    ~spinner() {
      stop();
    }

    virtual void start() {
      active_ = true;
      
      cout << "\e[?25l";
      cout.flush();
      
      thr_ = thread([&](){
	  int c = 0;
	  auto chars = CharSets[chars_];
	  int l = CharSets[chars_].size();
	  
	  while (active_)  { 
	    cout << "\r" << prefix_ << chars[c++ % l] << suffix_;
	    cout.flush();
	    std::this_thread::sleep_for(delay_);
	  }
	});
    }
    
    virtual void stop() {
      if (active_) {	
	active_ = false;
	thr_.join();
	cout << "\e[?25h";
	if(finalmsg_.size() > 0 )
	  cout << " - " << finalmsg_ << endl;
	cout.flush();	
      }
    }

  private:
    chrono::duration<int,std::milli> delay_;
    string prefix_;
    string suffix_;
    int chars_;
    string finalmsg_;
    bool active_;
    mutex lock_;
    thread thr_;
  };
}

#endif

